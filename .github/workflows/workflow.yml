name: Deploy with Issue Creation

on:
  workflow_dispatch:

jobs:
  fake-deploy-and-issue:
    runs-on: ubuntu-latest
    permissions:
      issues: write


    steps:
    - name: Checkout
      uses: actions/checkout@v3

    - name: Deploy
      run: echo "Simulating deploy..."

    - name: Check Application
      run: sleep 10s

    - name: Generate GitHub App Token
      id: generate_token
      uses: tibdex/github-app-token@v1
      with:
        app_id: ${{ secrets.APP_ID }}
        private_key: ${{ secrets.APP_PRIVATE_KEY }}


    - name: Open Issue
      uses: actions-ecosystem/action-create-issue@v1
      with:
        github_token: ${{ steps.generate_token.outputs.token }} # Usar o token gerado
        title: Erro 500
        body: | 
          Este Ã© um erro simulado gerado por um workflow de teste.
          Por favor, investigue a causa raiz do erro 500.
